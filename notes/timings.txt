with copy to host:
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 1
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 2801
       calced errors for upstream, layer 2: 0
       done biasweight backprop, layer 1: 1256
       done biasweight backprop, layer 2: 0
       done weight backprop, layer 1: 9203
       done weight backprop, layer 2: 2802
       propagate layer 1,  after copy to host: 2801
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 1904
       propagate layer 2,  after kernel enqueue: 0
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 1
       start backprop, layer 1: 0
       start backprop, layer 2: 0
   START: 0
       loss L: 39703.4
after epoch 22364 ms

empty backprop kernel, but with copytohost:
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 2
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 2801
       calced errors for upstream, layer 2: 0
       done biasweight backprop, layer 1: 1379
       done biasweight backprop, layer 2: 0
       done weight backprop, layer 1: 404
       done weight backprop, layer 2: 6
       propagate layer 1,  after copy to host: 2808
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 1820
       propagate layer 2,  after kernel enqueue: 0
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 3
       start backprop, layer 1: 0
       start backprop, layer 2: 0
   START: 0
       loss L: -nan
after epoch 11062 ms

only with clfinish, no copy to host, for backprop:
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 1
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 2800
       calced errors for upstream, layer 2: 0
       done biasweight backprop, layer 1: 1266
       done biasweight backprop, layer 2: 0
       done weight backprop, layer 1: 9201
       done weight backprop, layer 2: 2801
       propagate layer 1,  after copy to host: 2801
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 1895
       propagate layer 2,  after kernel enqueue: 0
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 1
       start backprop, layer 1: 0
       start backprop, layer 2: 0
   START: 0

=====================

fewer train examples:
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 3
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 701
       calced errors for upstream, layer 2: 0
       done biasweight backprop, layer 1: 317
       done biasweight backprop, layer 2: 0
       done weight backprop, layer 1: 2303
       done weight backprop, layer 2: 701
       propagate layer 1,  after copy to host: 703
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 481
       propagate layer 2,  after kernel enqueue: 0
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 1
       start backprop, layer 1: 0
       start backprop, layer 2: 0
   START: 0
       loss L: 27100.6
after epoch 5626 ms

============
make -j 4 unittests && ./unittests --gtest_filter=testbackprop.board19:

aws
backpropgpu: 1034ms
backpropguwithscratch: 291 no error
backpropgpu2: 200 error
backpropgpu3: error :-(  643
backpropgpu4: error   604

laptop:
backpropgpu: 404 no error
backpropguwithscratch: 374 no error
backpropgpu2: 57 error
backpropgpu3:  4206 no error
backpropgpu4: 4215 no error

-------------

make -j 4 testneuralnetmnistconvolve-experimental && ./testneuralnetmnistconvolve-experimental :

aws
backpropgpu  8772ms 81.7%
backpropgpuwithscratch  3437ms 81.2%   (weight backprop 1017, propagate layer 2 (includes kernel) 900)

laptop
backpropgpu   epoch: 5687ms, train 77.79%
backpropgpuwithscratch   epoch: 5319ms, train 84.0%  (weight backprop 1904)


===================

32 filters, x5, aws:

StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 200
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 200
       calced errors for upstream, layer 2: 0
       done biasweight backprop, layer 1: 811
       done biasweight backprop, layer 2: 0
       done weight backprop, layer 1: 1609
       done weight backprop, layer 2: 608
       propagate layer 1,  after copy to host: 1120
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 5042
       propagate layer 2,  after kernel enqueue: 678
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 480
       start backprop, layer 1: 0
       start backprop, layer 2: 0
       loss L: 8652.11
after epoch 7033 ms


====================

./testneuralnetmnistconvolve-experimental numlayers=2 numfilters=32:
numlayers=2 numfilters=32 , aws:

StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 468
       calcErrorsForUpstreamGpu, copied errors to device, layer 3: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 936
       calcErrorsForUpstreamGpu, copied results to host, layer 3: 468
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied weights to device, layer 3: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 468896
       calcErrorsForUpstreamGpu, finished kernel, layer 3: 468
       calced errors for upstream, layer 2: 0
       calced errors for upstream, layer 3: 1
       done biasweight backprop, layer 1: 4685
       done biasweight backprop, layer 2: 3744
       done biasweight backprop, layer 3: 0
       done weight backprop, layer 1: 7774
       done weight backprop, layer 2: 45333
       done weight backprop, layer 3: 1887
       propagate layer 1,  after copy to host: 2048
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 27562
       propagate layer 2,  after kernel enqueue: 967
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 937
       propagate layer 3,  after copy to host: 7020
       propagate layer 3,  after kernel enqueue: 937
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 472
       start backprop, layer 1: 0
       start backprop, layer 2: 0
       start backprop, layer 3: 0
   START: 0
       loss L: 25287.6
after epoch 0 578825 ms
train overall: 54148/60000 90.2467%
test overall: 9090/10000 90.9%
after tests 48775 ms


after fixing bug with range over filter:
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 468
       calcErrorsForUpstreamGpu, copied errors to device, layer 3: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 936
       calcErrorsForUpstreamGpu, copied results to host, layer 3: 468
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied weights to device, layer 3: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 216677
       calcErrorsForUpstreamGpu, finished kernel, layer 3: 468
       calced errors for upstream, layer 2: 0
       calced errors for upstream, layer 3: 0
       done biasweight backprop, layer 1: 4686
       done biasweight backprop, layer 2: 3280
       done biasweight backprop, layer 3: 0
       done weight backprop, layer 1: 7514
       done weight backprop, layer 2: 45034
       done weight backprop, layer 3: 1874
       propagate layer 1,  after copy to host: 1885
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 27550
       propagate layer 2,  after kernel enqueue: 953
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 938
       propagate layer 3,  after copy to host: 7020
       propagate layer 3,  after kernel enqueue: 936
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 468
       start backprop, layer 1: 0
       start backprop, layer 2: 0
       start backprop, layer 3: 0
   START: 0
       loss L: 21340.9
after epoch 0 325605 ms
train overall: 56437/60000 94.0617%
test overall: 9442/10000 94.42%

After streamlining kernel a bit ( limit range of filter for loops):
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 468
       calcErrorsForUpstreamGpu, copied errors to device, layer 3: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 936
       calcErrorsForUpstreamGpu, copied results to host, layer 3: 468
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied weights to device, layer 3: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 26209
       calcErrorsForUpstreamGpu, finished kernel, layer 3: 477
       calced errors for upstream, layer 2: 0
       calced errors for upstream, layer 3: 0
       done biasweight backprop, layer 1: 4685
       done biasweight backprop, layer 2: 3277
       done biasweight backprop, layer 3: 0
       done weight backprop, layer 1: 7529
       done weight backprop, layer 2: 45415
       done weight backprop, layer 3: 1872
       propagate layer 1,  after copy to host: 1898
       propagate layer 1,  after kernel enqueue: 1
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 27558
       propagate layer 2,  after kernel enqueue: 962
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 512
       propagate layer 3,  after copy to host: 7020
       propagate layer 3,  after kernel enqueue: 936
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 468
       start backprop, layer 1: 0
       start backprop, layer 2: 0
       start backprop, layer 3: 0
   START: 0
       loss L: 17747.5
after epoch 0 135193 ms
train overall: 57113/60000 95.1883%
test overall: 9550/10000 95.5%
after tests 48128 ms

aws, after moving results and weights to gpu, and consolidating bias backprop and weight backprop:
StatefulTimer readings:
       propagate layer 1,  after clFinish: 1141
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after clFinish: 26661
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 0
       propagate layer 3,  after clFinish: 7020
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 0
    backpropweightsGpu end, layer 3: 469
    backpropweightsGpu start, layer 3: 0
    backpropweightsGpuWithScratchAndBias end, layer 1: 4812
    backpropweightsGpuWithScratchAndBias end, layer 2: 36506
    backpropweightsGpuWithScratchAndBias start, layer 1: 0
    backpropweightsGpuWithScratchAndBias start, layer 2: 0
   START: 0
   backproperrors(): calced errors for upstream, layer 2: 0
   backproperrors(): calced errors for upstream, layer 3: 0
   backproperrors(): done biasweight backprop, layer 3: 0
   backproperrors(): done weight backprop, layer 1: 0
   backproperrors(): done weight backprop, layer 2: 0
   backproperrors(): done weight backprop, layer 3: 0
   backproperrors(): start backprop, layer 1: 0
   backproperrors(): start backprop, layer 2: 0
   backproperrors(): start backprop, layer 3: 0
   calcErrorsForUpstreamGpu end, layer 2: 27774
   calcErrorsForUpstreamGpu end, layer 3: 1405
   calcErrorsForUpstreamGpu start, layer 2: 0
   calcErrorsForUpstreamGpu start, layer 3: 0
   doBiasBackpropGpu end, layer 3: 0
   doBiasBackpropGpu start, layer 3: 0
       loss L: 25931.9
after epoch 0 107678 ms
train overall: 55525/60000 92.5417%
test overall: 9325/10000 93.25%
after tests 41381 ms

aws, after moving errors to gpu:
StatefulTimer readings:
       propagate layer 1,  after clFinish: 1243
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after clFinish: 26700
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 0
       propagate layer 3,  after clFinish: 7035
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 0
    backpropweightsGpu end, layer 3: 468
    backpropweightsGpu start, layer 3: 0
    backpropweightsGpuWithScratchAndBias end, layer 1: 2813
    backpropweightsGpuWithScratchAndBias end, layer 2: 35156
    backpropweightsGpuWithScratchAndBias start, layer 1: 0
    backpropweightsGpuWithScratchAndBias start, layer 2: 0
   START: 0
   after batch calc loss: 0
   after batch calc training num right: 0
   after batch forward-backward prop: 0
   backproperrors(): calced errors for upstream, layer 2: 0
   backproperrors(): calced errors for upstream, layer 3: 0
   backproperrors(): done biasweight backprop, layer 3: 0
   backproperrors(): done weight backprop, layer 1: 0
   backproperrors(): done weight backprop, layer 2: 0
   backproperrors(): done weight backprop, layer 3: 0
   backproperrors(): start backprop, layer 1: 0
   backproperrors(): start backprop, layer 2: 0
   backproperrors(): start backprop, layer 3: 0
   backproperrors(): updated weights, layer 1: 0
   backproperrors(): updated weights, layer 2: 0
   backproperrors(): updated weights, layer 3: 0
   calcErrorsForUpstreamGpu end, layer 2: 25314
   calcErrorsForUpstreamGpu end, layer 3: 469
   calcErrorsForUpstreamGpu start, layer 2: 0
   calcErrorsForUpstreamGpu start, layer 3: 0
   doBiasBackpropGpu end, layer 3: 0
   doBiasBackpropGpu start, layer 3: 0
   expectedvalueslayer: calcerrors end: 0
   expectedvalueslayer: calcerrors start: 0
       loss L: 23560.5
after epoch 0 101103 ms
train accuracy: 50862/60000 84.77%
test overall: 9306/10000 93.06%

aws, after moving errors,weights,results to gpu, adn simplifygin statefultimer output:
StatefulTimer readings:
       propagate layer 1,  after clFinish: 1225
       propagate layer 2,  after clFinish: 26701
       propagate layer 3,  after clFinish: 7035
    backpropweightsGpu end, layer 3: 468
    backpropweightsGpuWithScratchAndBias end, layer 1: 2813
    backpropweightsGpuWithScratchAndBias end, layer 2: 35156
   calcErrorsForUpstreamGpu end, layer 2: 25312
   calcErrorsForUpstreamGpu end, layer 3: 469
       loss L: 19693.6
after epoch 0 101080 ms
train accuracy: 53126/60000 88.5433%
test overall: 9382/10000 93.82%
after tests 5952 ms
...
StatefulTimer readings:
       propagate layer 1,  after clFinish: 1448
       propagate layer 2,  after clFinish: 31150
       propagate layer 3,  after clFinish: 8210
    backpropweightsGpu end, layer 3: 468
    backpropweightsGpuWithScratchAndBias end, layer 1: 2813
    backpropweightsGpuWithScratchAndBias end, layer 2: 35159
   calcErrorsForUpstreamGpu end, layer 2: 25312
   calcErrorsForUpstreamGpu end, layer 3: 469
       loss L: 12169.1
after epoch 1 101072 ms
train accuracy: 56664/60000 94.44%
test overall: 9539/10000 95.39%
after tests 5946 ms

...
StatefulTimer readings:
       propagate layer 1,  after clFinish: 1425
       propagate layer 2,  after clFinish: 31140
       propagate layer 2, START: 1
       propagate layer 3,  after clFinish: 8210
    backpropweightsGpu end, layer 3: 468
    backpropweightsGpuWithScratchAndBias end, layer 1: 2813
    backpropweightsGpuWithScratchAndBias end, layer 2: 35156
   calcErrorsForUpstreamGpu end, layer 2: 25313
   calcErrorsForUpstreamGpu end, layer 3: 469
       loss L: 9208.27
after epoch 4 101047 ms
train accuracy: 57778/60000 96.2967%
test overall: 9650/10000 96.5%
after tests 5944 ms


for 2 layers of filter size 3:

StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 936
       calcErrorsForUpstreamGpu, copied errors to device, layer 3: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 1368
       calcErrorsForUpstreamGpu, copied results to host, layer 3: 914
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied weights to device, layer 3: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 14040
       calcErrorsForUpstreamGpu, finished kernel, layer 3: 936
       calced errors for upstream, layer 2: 0
       calced errors for upstream, layer 3: 0
       done biasweight backprop, layer 1: 5278
       done biasweight backprop, layer 2: 4685
       done biasweight backprop, layer 3: 0
       done weight backprop, layer 1: 10768
       done weight backprop, layer 2: 134520
       done weight backprop, layer 3: 2533
       propagate layer 1,  after copy to host: 4057
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 30428
       propagate layer 2,  after kernel enqueue: 3046
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 1553
       propagate layer 3,  after copy to host: 21294
       propagate layer 3,  after kernel enqueue: 2264
       propagate layer 3, START: 3
       propagate layer 3, copied to device: 1034
       start backprop, layer 1: 0
       start backprop, layer 2: 0
       start backprop, layer 3: 0
       loss L: 12178.5
after epoch 1 209916 ms
train overall: 56907/60000 94.845%
test overall: 9520/10000 95.2%


========================
testsinglebatch.main
make -j 4 unittests && ./unittests --gtest_filter=testsinglebatch.main

initially:
aws: 1492
laptop: 6892

on aws, initialy:
batch time 1492 ms
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 10
       calcErrorsForUpstreamGpu, copied errors to device, layer 3: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 20
       calcErrorsForUpstreamGpu, copied results to host, layer 3: 5
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied weights to device, layer 3: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 280
       calcErrorsForUpstreamGpu, finished kernel, layer 3: 5
       calced errors for upstream, layer 2: 0  
       calced errors for upstream, layer 3: 0
       done biasweight backprop, layer 1: 0
       done biasweight backprop, layer 2: 0
       done biasweight backprop, layer 3: 0
       done weight backprop, layer 1: 90
       done weight backprop, layer 2: 502
       done weight backprop, layer 3: 20
       propagate layer 1,  after copy to host: 26
       propagate layer 1,  after kernel enqueue: 0
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 296
       propagate layer 2,  after kernel enqueue: 12
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 12
       propagate layer 3,  after copy to host: 75
       propagate layer 3,  after kernel enqueue: 10
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 7
       start backprop, layer 1: 0
       start backprop, layer 2: 0
       start backprop, layer 3: 0
   doBiasBackpropCpu end, layer 1: 45
   doBiasBackpropCpu end, layer 2: 30
   doBiasBackpropCpu end, layer 3: 0
   doBiasBackpropCpu start, layer 1: 0
   doBiasBackpropCpu start, layer 2: 0
   doBiasBackpropCpu start, layer 3: 0

on aws, after moving results, weights, to gpu, and merging bias backprop with weightbackprop:
batch time 1183 ms
StatefulTimer readings:
       propagate layer 1,  after clFinish: 11
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after clFinish: 285
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 0
       propagate layer 3,  after clFinish: 75
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 0
    backpropweightsGpu end, layer 3: 5
    backpropweightsGpu start, layer 3: 0
    backpropweightsGpuWithScratchAndBias end, layer 1: 61
    backpropweightsGpuWithScratchAndBias end, layer 2: 397
    backpropweightsGpuWithScratchAndBias start, layer 1: 0
    backpropweightsGpuWithScratchAndBias start, layer 2: 0
   backproperrors(): calced errors for upstream, layer 2: 0
   backproperrors(): calced errors for upstream, layer 3: 0
   backproperrors(): done biasweight backprop, layer 3: 0
   backproperrors(): done weight backprop, layer 1: 0   
   backproperrors(): done weight backprop, layer 2: 0   
   backproperrors(): done weight backprop, layer 3: 0   
   backproperrors(): start backprop, layer 1: 0
   backproperrors(): start backprop, layer 2: 0
   backproperrors(): start backprop, layer 3: 0
   calcErrorsForUpstreamGpu end, layer 2: 307
   calcErrorsForUpstreamGpu end, layer 3: 20
   calcErrorsForUpstreamGpu start, layer 2: 0
   calcErrorsForUpstreamGpu start, layer 3: 0
   doBiasBackpropGpu end, layer 3: 0
   doBiasBackpropGpu start, layer 3: 0

on aws, after moving errors onto gpu:
batch time 1077 ms
StatefulTimer readings:
       propagate layer 1,  after clFinish: 11
       propagate layer 1, START: 48
       propagate layer 1, copied to device: 0
       propagate layer 2,  after clFinish: 285
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 0
       propagate layer 3,  after clFinish: 75
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 0
    backpropweightsGpu end, layer 3: 5
    backpropweightsGpu start, layer 3: 0
    backpropweightsGpuWithScratchAndBias end, layer 1: 30
    backpropweightsGpuWithScratchAndBias end, layer 2: 375
    backpropweightsGpuWithScratchAndBias start, layer 1: 0
    backpropweightsGpuWithScratchAndBias start, layer 2: 0
   backproperrors(): calced errors for upstream, layer 2: 0
   backproperrors(): calced errors for upstream, layer 3: 0
   backproperrors(): done biasweight backprop, layer 3: 0
   backproperrors(): done weight backprop, layer 1: 0
   backproperrors(): done weight backprop, layer 2: 0
   backproperrors(): done weight backprop, layer 3: 0
   backproperrors(): start backprop, layer 1: 0
   backproperrors(): start backprop, layer 2: 0
   backproperrors(): start backprop, layer 3: 0
   backproperrors(): updated weights, layer 1: 0
   backproperrors(): updated weights, layer 2: 0
   backproperrors(): updated weights, layer 3: 0
   calcErrorsForUpstreamGpu end, layer 2: 270
   calcErrorsForUpstreamGpu end, layer 3: 5
   calcErrorsForUpstreamGpu start, layer 2: 0
   calcErrorsForUpstreamGpu start, layer 3: 0
   doBiasBackpropGpu end, layer 3: 0
   doBiasBackpropGpu start, layer 3: 0
   expectedvalueslayer: calcerrors end: 0
   expectedvalueslayer: calcerrors start: 0

aws, propagate2:
batch time 893 ms
StatefulTimer readings:
    backpropweightsGpuWithScratchAndBias end, layer 1: 30ms
    backpropweightsGpuWithScratchAndBias end, layer 2: 375ms
    backpropweightsGpuWithScratchAndBias end, layer 3: 10ms
   Propagate1::propagate after call propagate: 75ms
   Propagate2::propagate after call propagate: 110ms
   calcErrorsForUpstreamGpu end, layer 2: 270ms
   calcErrorsForUpstreamGpu end, layer 3: 5ms

aws, propagate3, kernel4:
batch time 891 ms
StatefulTimer readings:
    backpropweightsGpuWithScratchAndBias end, layer 1: 30ms
    backpropweightsGpuWithScratchAndBias end, layer 2: 375ms
    backpropweightsGpuWithScratchAndBias end, layer 3: 10ms
   Propagate1::propagate after call propagate: 75ms
   Propagate3::propagate after call propagate: 110ms
   calcErrorsForUpstreamGpu end, layer 2: 270ms
   calcErrorsForUpstreamGpu end, layer 3: 5ms

aws, propagate3, kernel5:
batch time 893 ms
StatefulTimer readings:
    backpropweightsGpuWithScratchAndBias end, layer 1: 30ms
    backpropweightsGpuWithScratchAndBias end, layer 2: 375ms
    backpropweightsGpuWithScratchAndBias end, layer 3: 10ms
   Propagate1::propagate after call propagate: 75ms
   Propagate3::propagate after call propagate: 113ms
   calcErrorsForUpstreamGpu end, layer 2: 270ms
   calcErrorsForUpstreamGpu end, layer 3: 5ms

on laptop, initially:
batch time 6892 ms
StatefulTimer readings:
       calcErrorsForUpstreamGpu, copied errors to device, layer 2: 2
       calcErrorsForUpstreamGpu, copied errors to device, layer 3: 0
       calcErrorsForUpstreamGpu, copied results to host, layer 2: 10
       calcErrorsForUpstreamGpu, copied results to host, layer 3: 5
       calcErrorsForUpstreamGpu, copied weights to device, layer 2: 0
       calcErrorsForUpstreamGpu, copied weights to device, layer 3: 0
       calcErrorsForUpstreamGpu, finished kernel, layer 2: 1611
       calcErrorsForUpstreamGpu, finished kernel, layer 3: 56
       calced errors for upstream, layer 2: 0
       calced errors for upstream, layer 3: 0
       done biasweight backprop, layer 1: 0
       done biasweight backprop, layer 2: 0
       done biasweight backprop, layer 3: 0
       done weight backprop, layer 1: 162
       done weight backprop, layer 2: 3245
       done weight backprop, layer 3: 57
       propagate layer 1,  after copy to host: 106
       propagate layer 1,  after kernel enqueue: 2
       propagate layer 1, START: 1
       propagate layer 1, copied to device: 0
       propagate layer 2,  after copy to host: 1474
       propagate layer 2,  after kernel enqueue: 2
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 7
       propagate layer 3,  after copy to host: 35
       propagate layer 3,  after kernel enqueue: 0
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 6
       start backprop, layer 1: 0
       start backprop, layer 2: 0
       start backprop, layer 3: 0
   doBiasBackpropCpu end, layer 1: 41
   doBiasBackpropCpu end, layer 2: 25
   doBiasBackpropCpu end, layer 3: 0
   doBiasBackpropCpu start, layer 1: 0
   doBiasBackpropCpu start, layer 2: 0
   doBiasBackpropCpu start, layer 3: 0

with results and weights on cpu, bias still caled separately, laptop:
batch time 6935 ms
StatefulTimer readings:
       propagate layer 1,  after clFinish: 78
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after clFinish: 1467
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 0
       propagate layer 3,  after clFinish: 40
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 0
    backpropweightsGpu end, layer 3: 51
    backpropweightsGpu start, layer 3: 0
    backpropweightsGpuWithScratch end, layer 1: 152
    backpropweightsGpuWithScratch end, layer 2: 3230
    backpropweightsGpuWithScratch start, layer 1: 0
    backpropweightsGpuWithScratch start, layer 2: 0
   backproperrors(): calced errors for upstream, layer 2: 0
   backproperrors(): calced errors for upstream, layer 3: 0
   backproperrors(): done biasweight backprop, layer 1: 0
   backproperrors(): done biasweight backprop, layer 2: 0
   backproperrors(): done biasweight backprop, layer 3: 0
   backproperrors(): done weight backprop, layer 1: 0
   backproperrors(): done weight backprop, layer 2: 0
   backproperrors(): done weight backprop, layer 3: 0
   backproperrors(): start backprop, layer 1: 0
   backproperrors(): start backprop, layer 2: 0
   backproperrors(): start backprop, layer 3: 0
   calcErrorsForUpstreamGpu end, layer 2: 1629
   calcErrorsForUpstreamGpu end, layer 3: 64
   calcErrorsForUpstreamGpu start, layer 2: 0
   calcErrorsForUpstreamGpu start, layer 3: 0
   doBiasBackpropGpu end, layer 1: 117
   doBiasBackpropGpu end, layer 2: 78
   doBiasBackpropGpu end, layer 3: 0
   doBiasBackpropGpu start, layer 1: 0
   doBiasBackpropGpu start, layer 2: 0
   doBiasBackpropGpu start, layer 3: 0

merge bias weight backprop, laptop, longer :-P:
batch time 7121 ms
StatefulTimer readings:
       propagate layer 1,  after clFinish: 77
       propagate layer 1, START: 0
       propagate layer 1, copied to device: 0
       propagate layer 2,  after clFinish: 1466
       propagate layer 2, START: 0
       propagate layer 2, copied to device: 0
       propagate layer 3,  after clFinish: 39
       propagate layer 3, START: 0
       propagate layer 3, copied to device: 0
    backpropweightsGpu end, layer 3: 51
    backpropweightsGpu start, layer 3: 0
    backpropweightsGpuWithScratchAndBias end, layer 1: 157
    backpropweightsGpuWithScratchAndBias end, layer 2: 3612
    backpropweightsGpuWithScratchAndBias start, layer 1: 0
    backpropweightsGpuWithScratchAndBias start, layer 2: 0
   backproperrors(): calced errors for upstream, layer 2: 0
   backproperrors(): calced errors for upstream, layer 3: 0
   backproperrors(): done biasweight backprop, layer 3: 0
   backproperrors(): done weight backprop, layer 1: 0
   backproperrors(): done weight backprop, layer 2: 0
   backproperrors(): done weight backprop, layer 3: 0
   backproperrors(): start backprop, layer 1: 0
   backproperrors(): start backprop, layer 2: 0
   backproperrors(): start backprop, layer 3: 0
   calcErrorsForUpstreamGpu end, layer 2: 1629
   calcErrorsForUpstreamGpu end, layer 3: 64
   calcErrorsForUpstreamGpu start, layer 2: 0
   calcErrorsForUpstreamGpu start, layer 3: 0
   doBiasBackpropGpu end, layer 3: 0
   doBiasBackpropGpu start, layer 3: 0


============================

======================

numlayers=3 numfilters=32

aws, propagate1:
StatefulTimer readings:
    backpropweightsGpuWithScratchAndBias end, layer 1: 2812ms
    backpropweightsGpuWithScratchAndBias end, layer 2: 35156ms
    backpropweightsGpuWithScratchAndBias end, layer 3: 16406ms
    backpropweightsGpuWithScratchAndBias end, layer 4: 21ms
   Propagate1::propagate after call propagate: 48001ms
   calcErrorsForUpstreamGpu end, layer 2: 25312ms
   calcErrorsForUpstreamGpu end, layer 3: 16407ms
       loss L: 24742.6
after epoch 0 147829 ms

aws, propagate2:
StatefulTimer readings:
    backpropweightsGpuWithScratchAndBias end, layer 1: 2814ms
    backpropweightsGpuWithScratchAndBias end, layer 2: 35156ms
    backpropweightsGpuWithScratchAndBias end, layer 3: 16406ms
    backpropweightsGpuWithScratchAndBias end, layer 4: 9ms
   Propagate1::propagate after call propagate: 4222ms
   Propagate2::propagate after call propagate: 16887ms
   calcErrorsForUpstreamGpu end, layer 2: 25313ms
   calcErrorsForUpstreamGpu end, layer 3: 16406ms
       loss L: 23881.5
after epoch 0 120584 ms

aws, propagate3, kernel4:
StatefulTimer readings:
    backpropweightsGpuWithScratchAndBias end, layer 1: 2812ms
    backpropweightsGpuWithScratchAndBias end, layer 2: 35156ms
    backpropweightsGpuWithScratchAndBias end, layer 3: 16406ms
    backpropweightsGpuWithScratchAndBias end, layer 4: 9ms
   Propagate1::propagate after call propagate: 4221ms
   Propagate2::propagate after call propagate: 16884ms
   calcErrorsForUpstreamGpu end, layer 2: 25313ms
   calcErrorsForUpstreamGpu end, layer 3: 16406ms
       loss L: 25091.3
after epoch 0 120589 ms

aws, propagate3, kernel5:
StatefulTimer readings:
    backpropweightsGpuWithScratchAndBias end, layer 1: 2812ms
    backpropweightsGpuWithScratchAndBias end, layer 2: 35156ms
    backpropweightsGpuWithScratchAndBias end, layer 3: 16406ms
    backpropweightsGpuWithScratchAndBias end, layer 4: 1ms
   Propagate1::propagate after call propagate: 4221ms
   Propagate3::propagate after call propagate: 16618ms
   calcErrorsForUpstreamGpu end, layer 2: 25312ms
   calcErrorsForUpstreamGpu end, layer 3: 16406ms
       loss L: 24232
after epoch 0 120256 ms


------------
aws, 64 filters, 3 layers (?), filtersize 3, v0.3, softmax
StatefulTimer readings:
   layer1 BackpropWeights2Scratch end: 3281ms
   layer1 Propagate3::propagate after call propagate: 1093ms
   layer2 BackpropErrorsv2Naive end: 49628ms
   layer2 BackpropWeights2Scratch end: 179538ms
   layer2 Propagate3::propagate after call propagate: 33358ms
   layer3 BackpropErrorsv2Naive end: 1406ms
   layer3 BackpropWeights2Scratch end: 2343ms
   layer3 Propagate1::propagate after call propagate: 23543ms
       loss L: 2257.07
after epoch 16 287540 ms

aws, 32 filters, padzeros=1, numlayers=2 filtersize=5, v0.3, softmax
StatefulTimer readings:
   layer1 BackpropWeights2Scratch end: 5625ms
   layer1 Propagate3::propagate after call propagate: 1093ms
   layer2 BackpropErrorsv2Naive end: 45938ms
   layer2 BackpropWeights2Scratch end: 107344ms
   layer2 Propagate3::propagate after call propagate: 30017ms
   layer3 BackpropErrorsv2Naive end: 937ms
   layer3 BackpropWeights2Scratch end: 1407ms
   layer3 Propagate1::propagate after call propagate: 15877ms
       loss L: 1965.96
after epoch 17 203420 ms

aws, 32 filters, padzeros=1, numlayers=3, filtersize=5, v0.3, softmax
StatefulTimer readings:
   layer1 BackpropWeights2Scratch end: 5625ms
   layer1 Propagate3::propagate after call propagate: 937ms
   layer2 BackpropErrorsv2Naive end: 45938ms
   layer2 BackpropWeights2Scratch end: 107344ms
   layer2 Propagate3::propagate after call propagate: 25715ms
   layer3 BackpropErrorsv2Naive end: 45938ms
   layer3 BackpropWeights2Scratch end: 107344ms
   layer3 Propagate3::propagate after call propagate: 25723ms
   layer4 BackpropErrorsv2Naive end: 937ms
   layer4 BackpropWeights2Scratch end: 1411ms
   layer4 Propagate1::propagate after call propagate: 13600ms
       loss L: 22727.5
after epoch 0 383196 ms



